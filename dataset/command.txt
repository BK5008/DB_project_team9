＃改的地方是subquery pokemon_id=###改成使用者選出要查的pokemon
#不允許選出來的pokemon可能被剋屬
SELECT DISTINCT p.pokemon_id, pokemon_name, max_cp, MAX(sk.name) FROM pokemon p JOIN (SELECT pokemon_id, name, type FROM skill JOIN skilltype ON skill_name=name) sk ON p.pokemon_id=sk.pokemon_id WHERE (type1 NOT IN (SELECT DISTINCT against FROM type JOIN (SELECT type1, type2 FROM pokemon WHERE pokemon_id=473) AS Z ON type=type1 OR type=type2 WHERE scale>1) AND type2 NOT IN (SELECT DISTINCT against FROM type JOIN (SELECT type1, type2 FROM pokemon WHERE pokemon_id=473) AS Z ON type=type1 OR type=type2 WHERE scale>1)) AND (type1 IN (SELECT DISTINCT type FROM type JOIN (SELECT type1, type2 FROM pokemon WHERE pokemon_id=473) AS Z ON against=type1 OR against=type2 WHERE scale>1) OR type2 IN (SELECT DISTINCT type FROM type JOIN (SELECT type1, type2 FROM pokemon WHERE pokemon_id=473) AS Z ON against=type1 OR against=type2 WHERE scale>1)) AND (type=type1 OR type=type2) GROUP BY p.pokemon_id, pokemon_name, max_cp ORDER BY max_cp DESC LIMIT 10;

#只要有剋對面就允許(likely wrong)
SELECT DISTINCT p.pokemon_id, pokemon_name, max_cp, MAX(sk.name) FROM pokemon p JOIN (SELECT pokemon_id, name, type FROM skill JOIN skilltype ON skill_name=name) sk ON p.pokemon_id=sk.pokemon_id WHERE (type1 IN (SELECT DISTINCT type FROM type JOIN (SELECT type1, type2 FROM pokemon WHERE pokemon_id=473) AS Z ON against=type1 OR against=type2 WHERE scale>1) OR type2 IN (SELECT DISTINCT type FROM type JOIN (SELECT type1, type2 FROM pokemon WHERE pokemon_id=473) AS Z ON against=type1 OR against=type2 WHERE scale>1)) AND (type=type1 OR type=type2) GROUP BY p.pokemon_id, pokemon_name, max_cp ORDER BY max_cp DESC LIMIT 10;

＃mypokemon
SELECT p.pokemon_id, pokemon_name, pokemon_cp, MAX(sk.name) FROM pokemon p JOIN user u ON p.pokemon_id=u.pokemon_id JOIN (SELECT pokemon_id, name, type FROM skill JOIN skilltype ON skill_name=name) sk ON p.pokemon_id=sk.pokemon_id WHERE (type1 NOT IN (SELECT DISTINCT against FROM type JOIN (SELECT type1, type2 FROM pokemon WHERE pokemon_id=1) AS Z ON type=type1 OR type=type2 WHERE scale>1) AND type2 NOT IN (SELECT DISTINCT against FROM type JOIN (SELECT type1, type2 FROM pokemon WHERE pokemon_id=1) AS Z ON type=type1 OR type=type2 WHERE scale>1)) AND (type1 IN (SELECT DISTINCT type FROM type JOIN (SELECT type1, type2 FROM pokemon WHERE pokemon_id=1) AS Z ON against=type1 OR against=type2 WHERE scale>1) OR type2 IN (SELECT DISTINCT type FROM type JOIN (SELECT type1, type2 FROM pokemon WHERE pokemon_id=1) AS Z ON against=type1 OR against=type2 WHERE scale>1)) GROUP BY p.pokemon_id, pokemon_name, pokemon_cp ORDER BY pokemon_cp DESC LIMIT 10;


